import{t as e}from"./building-Db3oIjcF.js";import{t}from"./calendar-BE1FZPaA.js";import{t as n}from"./credit-card-BHHW6Ujc.js";import{t as r}from"./eye-Cwh_TdE9.js";import{t as i}from"./layers-Cv9WIzFk.js";import{t as a}from"./plus-CEMkcid2.js";import{t as o}from"./save-Du0TzjDU.js";import{t as s}from"./search-7QJDYU_6.js";import{t as c}from"./trash-2-Eo-Zwxxt.js";import{t as l}from"./user-CxNvStxo.js";import{c as u,i as d,n as f,r as p,u as m,w as h,y as g}from"./index-FG9feFxU.js";var _=u(`hard-drive`,[[`line`,{x1:`22`,x2:`2`,y1:`12`,y2:`12`,key:`1y58io`}],[`path`,{d:`M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z`,key:`oot6mr`}],[`line`,{x1:`6`,x2:`6.01`,y1:`16`,y2:`16`,key:`sgf278`}],[`line`,{x1:`10`,x2:`10.01`,y1:`16`,y2:`16`,key:`1l4acy`}]]),v=h(g(),1),y=p();function b(){let[u,p]=(0,v.useState)([]),[h,g]=(0,v.useState)(!0),[b,x]=(0,v.useState)(``),[S,C]=(0,v.useState)([]),[w,T]=(0,v.useState)(null),[E,D]=(0,v.useState)(null),[O,k]=(0,v.useState)({}),[A,j]=(0,v.useState)(``),[M,N]=(0,v.useState)(``),[P,F]=(0,v.useState)(`active`);(0,v.useEffect)(()=>{I(),L()},[]);let I=()=>{g(!0),f.get(`/sa/companies`).then(e=>p(e.data.companies||[])).catch(e=>console.error(e)).finally(()=>g(!1))},L=()=>{f.get(`/sa/plans`).then(e=>C(e.data||[])).catch(e=>console.error(e))},R=(e,t)=>{if(T(e),D(t),t===`features`){let t=e.planId?._id||e.planId,n=S.find(e=>e._id===t)?.defaultFlags||{},r=e.featureFlags||{};k({...n,...r})}t===`plan`&&(j(e.planId?._id||e.planId),e.subscriptionEndsAt?N(new Date(e.subscriptionEndsAt).toISOString().split(`T`)[0]):e.trialEndsAt?N(new Date(e.trialEndsAt).toISOString().split(`T`)[0]):N(``),F(e.subscriptionStatus||`active`))},z=()=>{D(null),T(null)},B=async()=>{try{await f.patch(`/sa/companies/${w._id}/plan`,{planId:A}),m.success(`Plan updated successfully!`),I(),z()}catch(e){m.error(`Failed to update plan: `+e.message)}},V=async()=>{try{await f.patch(`/sa/companies/${w._id}/status`,{status:P,subscriptionEndsAt:M}),m.success(`Subscription updated!`),I(),z()}catch(e){m.error(`Failed to update status: `+e.message)}},H=async()=>{try{let e=w.planId?._id||w.planId,t=S.find(t=>t._id===e)?.defaultFlags||{},n={};Object.keys(O).forEach(e=>{let r=t[e],i=O[e];i!==r&&(n[e]=i)}),await f.patch(`/sa/companies/${w._id}/flags`,{flags:n,replace:!0}),m.success(`Features updated! Inheritance preserved for unchanged flags.`),I(),z()}catch(e){m.error(`Failed to update features: `+e.message)}},U=async()=>{if(window.confirm(`Are you sure? This will remove all custom overrides and revert the company to the Plan's default features.`))try{await f.patch(`/sa/companies/${w._id}/flags`,{flags:{},replace:!0}),m.success(`Reset to Plan Defaults successfully!`),I(),z()}catch(e){m.error(`Failed to reset: `+e.message)}},W=async e=>{if(window.confirm(`⚠️ DANGER: Are you sure you want to permanently DELETE this company? This action cannot be undone.`))try{await f.delete(`/sa/companies/${e}`),m.success(`Company deleted successfully`),I()}catch(e){console.error(e),m.error(`Failed to delete company: `+(e.response?.data?.message||e.message))}},G=e=>{k(t=>({...t,[e]:!t[e]}))},K=(u||[]).filter(e=>e?.name&&e.name.toLowerCase().includes((b||``).toLowerCase()));return(0,y.jsxs)(`div`,{className:`space-y-6`,children:[(0,y.jsxs)(`div`,{children:[(0,y.jsx)(`h1`,{className:`text-2xl font-bold text-slate-800`,children:`Companies Management`}),(0,y.jsx)(`p`,{className:`text-sm text-slate-500 mt-1`,children:`Manage client workspaces, plans, and subscription status.`})]}),(0,y.jsxs)(`div`,{className:`flex flex-col md:flex-row justify-between gap-4`,children:[(0,y.jsxs)(`div`,{className:`relative flex-1 max-w-md`,children:[(0,y.jsx)(s,{className:`absolute left-3 top-2.5 h-4 w-4 text-slate-400`}),(0,y.jsx)(`input`,{type:`text`,placeholder:`Search companies...`,value:b,onChange:e=>x(e.target.value),className:`w-full pl-10 pr-4 py-2 rounded-lg border border-slate-200 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500`})]}),(0,y.jsxs)(`button`,{onClick:()=>window.location.href=`/dashboard/companies/new`,className:`bg-indigo-600 text-white px-4 py-2 rounded-lg font-bold shadow-md hover:bg-indigo-700 transition-all flex items-center gap-2`,children:[(0,y.jsx)(a,{size:18}),` New Company`]})]}),(0,y.jsx)(`div`,{className:`bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden`,children:(0,y.jsx)(`div`,{className:`overflow-x-auto`,children:(0,y.jsxs)(`table`,{className:`min-w-full divide-y divide-slate-200`,children:[(0,y.jsx)(`thead`,{className:`bg-slate-50 text-xs uppercase font-semibold text-slate-500`,children:(0,y.jsxs)(`tr`,{children:[(0,y.jsx)(`th`,{className:`px-6 py-4 text-left`,children:`Company Name`}),(0,y.jsx)(`th`,{className:`px-6 py-4 text-left`,children:`Plan Type`}),(0,y.jsx)(`th`,{className:`px-6 py-4 text-left`,children:`Subscription Ends`}),(0,y.jsx)(`th`,{className:`px-6 py-4 text-left`,children:`Status (Click to Edit)`}),(0,y.jsx)(`th`,{className:`px-6 py-4 text-right`,children:`Actions`})]})}),(0,y.jsx)(`tbody`,{className:`divide-y divide-slate-200`,children:h?(0,y.jsx)(`tr`,{children:(0,y.jsx)(`td`,{colSpan:`6`,className:`px-6 py-10 text-center text-slate-500`,children:`Loading companies...`})}):(K||[]).map(e=>(0,y.jsxs)(`tr`,{className:`hover:bg-slate-50 transition-colors`,children:[(0,y.jsxs)(`td`,{className:`px-6 py-4 whitespace-nowrap cursor-pointer hover:bg-slate-100`,onClick:()=>R(e,`details`),children:[(0,y.jsx)(`div`,{className:`font-semibold text-blue-600 hover:text-blue-800 hover:underline`,children:e.name}),(0,y.jsxs)(`div`,{className:`text-xs text-slate-400`,children:[`ID: `,e._id.slice(-6).toUpperCase()]})]}),(0,y.jsx)(`td`,{className:`px-6 py-4 whitespace-nowrap`,children:(0,y.jsx)(`span`,{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-50 text-blue-700`,children:e.planId?.name||`Unknown Plan`})}),(0,y.jsx)(`td`,{className:`px-6 py-4 whitespace-nowrap text-sm`,children:e.subscriptionEndsAt?(0,y.jsxs)(`div`,{children:[(0,y.jsx)(`div`,{className:`font-medium ${new Date(e.subscriptionEndsAt)<new Date?`text-red-600`:`text-slate-600`}`,children:new Date(e.subscriptionEndsAt).toLocaleDateString()}),new Date(e.subscriptionEndsAt)<new Date&&(0,y.jsx)(`span`,{className:`text-[10px] uppercase font-bold text-red-500 bg-red-50 px-1.5 py-0.5 rounded border border-red-100 ml-1`,children:`Overdue`})]}):e.trialEndsAt?(0,y.jsxs)(`span`,{className:`text-orange-600`,children:[`Trial: `,new Date(e.trialEndsAt).toLocaleDateString()]}):`N/A`}),(0,y.jsxs)(`td`,{className:`px-6 py-4 whitespace-nowrap cursor-pointer hover:bg-slate-100`,onClick:()=>R(e,`plan`),children:[e.subscriptionStatus===`active`&&e.subscriptionEndsAt&&new Date(e.subscriptionEndsAt)<new Date?(0,y.jsx)(`span`,{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize bg-orange-100 text-orange-800 border border-orange-200`,children:`Active (Overdue)`}):(0,y.jsx)(`span`,{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize
                                                ${e.subscriptionStatus===`active`?`bg-green-100 text-green-800`:`bg-red-100 text-red-800`}`,children:e.subscriptionStatus}),(0,y.jsx)(`span`,{className:`ml-2 text-xs text-slate-400 opacity-0 hover:opacity-100 underline`,children:`Change`})]}),(0,y.jsx)(`td`,{className:`px-6 py-4 whitespace-nowrap text-right text-sm font-medium`,children:(0,y.jsxs)(`div`,{className:`flex items-center justify-end gap-2`,children:[(0,y.jsx)(`button`,{onClick:()=>window.location.href=`/dashboard/backup-reports?companyId=${e._id}`,className:`text-amber-600 hover:text-amber-800 flex items-center gap-1`,title:`View Backups`,children:(0,y.jsx)(_,{size:16})}),(0,y.jsx)(`button`,{onClick:()=>R(e,`details`),className:`text-slate-600 hover:text-blue-600 flex items-center gap-1`,title:`View Details`,children:(0,y.jsx)(r,{size:16})}),(0,y.jsxs)(`button`,{onClick:()=>R(e,`features`),className:`text-purple-600 hover:text-purple-800 flex items-center gap-1`,title:`Manage Features`,children:[(0,y.jsx)(i,{size:16}),` Features`]}),(0,y.jsx)(`button`,{onClick:()=>W(e._id),className:`text-red-500 hover:text-red-700 flex items-center gap-1 ml-2`,title:`Delete Company`,children:(0,y.jsx)(c,{size:16})})]})})]},e._id))})]})})}),E&&w&&(0,y.jsx)(`div`,{className:`fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4`,children:(0,y.jsxs)(`div`,{className:`bg-white rounded-xl shadow-2xl w-full max-w-2xl overflow-hidden flex flex-col max-h-[90vh]`,children:[(0,y.jsxs)(`div`,{className:`px-6 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50`,children:[(0,y.jsxs)(`div`,{children:[(0,y.jsxs)(`h3`,{className:`font-bold text-lg text-slate-800`,children:[E===`details`&&`Company Details`,E===`plan`&&`Manage Plan & Subscription`,E===`features`&&`Manage Module Features`]}),(0,y.jsx)(`p`,{className:`text-xs text-slate-500 uppercase tracking-widest`,children:w.name})]}),(0,y.jsx)(`button`,{onClick:z,className:`text-slate-400 hover:text-red-500 transition-colors`,children:(0,y.jsx)(d,{size:24})})]}),(0,y.jsxs)(`div`,{className:`p-6 overflow-y-auto flex-1`,children:[E===`details`&&(0,y.jsxs)(`div`,{className:`space-y-4`,children:[(0,y.jsxs)(`div`,{className:`grid grid-cols-2 gap-4`,children:[(0,y.jsxs)(`div`,{className:`p-3 bg-slate-50 rounded-lg border border-slate-100`,children:[(0,y.jsx)(`label`,{className:`text-xs font-bold text-slate-400 uppercase`,children:`Email`}),(0,y.jsxs)(`div`,{className:`text-slate-800 font-medium flex items-center gap-2`,children:[(0,y.jsx)(l,{size:14}),` `,w.email||`N/A`]})]}),(0,y.jsxs)(`div`,{className:`p-3 bg-slate-50 rounded-lg border border-slate-100`,children:[(0,y.jsx)(`label`,{className:`text-xs font-bold text-slate-400 uppercase`,children:`Phone`}),(0,y.jsx)(`div`,{className:`text-slate-800 font-medium`,children:w.phone||`N/A`})]}),(0,y.jsxs)(`div`,{className:`col-span-2 p-3 bg-slate-50 rounded-lg border border-slate-100`,children:[(0,y.jsx)(`label`,{className:`text-xs font-bold text-slate-400 uppercase`,children:`Address`}),(0,y.jsxs)(`div`,{className:`text-slate-800 font-medium flex items-center gap-2`,children:[(0,y.jsx)(e,{size:14}),` `,w.address||`N/A`]})]})]}),(0,y.jsxs)(`div`,{className:`mt-4`,children:[(0,y.jsx)(`h4`,{className:`font-semibold text-slate-700 mb-2`,children:`Technical Details`}),(0,y.jsx)(`pre`,{className:`bg-slate-900 text-slate-50 p-3 rounded text-xs overflow-x-auto`,children:JSON.stringify({createdAt:w.createdAt,apiKey:w.apiKey?`***`+w.apiKey.slice(-4):`None`,devices:w.devices?.length||0,trialEndsAt:w.trialEndsAt,subscriptionEndsAt:w.subscriptionEndsAt},null,2)})]})]}),E===`plan`&&(0,y.jsxs)(`div`,{className:`space-y-6`,children:[(0,y.jsxs)(`div`,{className:`p-4 border border-blue-100 bg-blue-50/50 rounded-xl`,children:[(0,y.jsxs)(`h4`,{className:`font-semibold text-blue-900 flex items-center gap-2 mb-3`,children:[(0,y.jsx)(n,{size:18}),` Change Plan`]}),(0,y.jsxs)(`div`,{className:`flex gap-2`,children:[(0,y.jsx)(`select`,{value:A,onChange:e=>j(e.target.value),className:`flex-1 rounded-lg border-slate-300 text-slate-700 focus:ring-blue-500 focus:border-blue-500`,children:S.map(e=>(0,y.jsxs)(`option`,{value:e._id,children:[e.name,` - $`,e.priceMonthly,`/mo`]},e._id))}),(0,y.jsx)(`button`,{onClick:B,className:`bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition-colors`,children:`Update Plan`})]})]}),(0,y.jsxs)(`div`,{className:`p-4 border border-orange-100 bg-orange-50/50 rounded-xl`,children:[(0,y.jsxs)(`h4`,{className:`font-semibold text-orange-900 flex items-center gap-2 mb-3`,children:[(0,y.jsx)(t,{size:18}),` Subscription Validity`]}),(0,y.jsxs)(`div`,{className:`space-y-3`,children:[(0,y.jsxs)(`div`,{children:[(0,y.jsx)(`label`,{className:`block text-sm font-medium text-slate-700 mb-1`,children:`Status`}),(0,y.jsxs)(`select`,{value:P,onChange:e=>F(e.target.value),className:`w-full rounded-lg border-slate-300 focus:ring-orange-500 focus:border-orange-500 mb-3`,children:[(0,y.jsx)(`option`,{value:`active`,children:`Active`}),(0,y.jsx)(`option`,{value:`trial`,children:`Trial`}),(0,y.jsx)(`option`,{value:`past_due`,children:`Past Due`}),(0,y.jsx)(`option`,{value:`suspended`,children:`Suspended`}),(0,y.jsx)(`option`,{value:`cancelled`,children:`Cancelled`})]}),(0,y.jsx)(`label`,{className:`block text-sm font-medium text-slate-700 mb-1`,children:`Subscription Ends At`}),(0,y.jsx)(`input`,{type:`date`,value:M,onChange:e=>N(e.target.value),className:`w-full rounded-lg border-slate-300 focus:ring-orange-500 focus:border-orange-500`})]}),(0,y.jsx)(`button`,{onClick:V,className:`w-full bg-orange-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-orange-700 transition-colors`,children:`Update Status & Date`})]})]})]}),E===`features`&&(0,y.jsxs)(`div`,{className:`space-y-4`,children:[(0,y.jsx)(`div`,{className:`grid grid-cols-1 gap-4`,children:[{key:`module_finance`,label:`Finance`,desc:`Financial management core`},{key:`module_invoicing`,label:`Invoicing`,desc:`Create and send invoices`},{key:`module_inventory`,label:`Inventory`,desc:`Stock & product management`},{key:`module_employees`,label:`HR & Payroll`,desc:`Employees, Leaves & Payroll`},{key:`module_calendar`,label:`Calendar`,desc:`Scheduling & events`},{key:`module_broadcasts`,label:`Broadcasts`,desc:`Mass messaging tools`},{key:`module_analytics`,label:`Analytics`,desc:`Reports & insights`},{key:`module_backup`,label:`Backup & Data Export`,desc:`Full company data exports and history`},{key:`ai_enabled`,label:`AI Assistant`,desc:`Smart recommendations and help`}].map(e=>(0,y.jsxs)(`div`,{className:`flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-100 hover:border-slate-300 transition-colors`,children:[(0,y.jsxs)(`div`,{children:[(0,y.jsx)(`div`,{className:`font-medium text-slate-900`,children:e.label}),(0,y.jsx)(`div`,{className:`text-xs text-slate-500`,children:e.desc})]}),(0,y.jsx)(`input`,{type:`checkbox`,checked:!!O[e.key],onChange:()=>G(e.key),className:`h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer`})]},e.key))}),(0,y.jsxs)(`div`,{className:`flex justify-between pt-4 border-t border-slate-100 mt-4`,children:[(0,y.jsxs)(`button`,{onClick:U,className:`text-slate-500 hover:text-red-600 text-sm font-medium flex items-center gap-1`,children:[(0,y.jsx)(i,{size:14}),` Reset to Plan Defaults`]}),(0,y.jsxs)(`button`,{onClick:H,className:`bg-purple-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-purple-700 transition-colors flex items-center gap-2`,children:[(0,y.jsx)(o,{size:16}),` Save Changes`]})]})]})]})]})})]})}export{b as default};