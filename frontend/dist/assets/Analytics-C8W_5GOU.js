import{t as e}from"./dollar-sign-Dpwxw7ZW.js";import{t}from"./download-DkTWPRZE.js";import{t as n}from"./file-text-X3F31LPe.js";import{t as r}from"./package-B4XiGOGU.js";import{t as i}from"./trending-up-DzsNZMSM.js";import{t as a}from"./triangle-alert-CVdzsyTG.js";import{t as o}from"./users-Bws8m-qo.js";import{n as s,r as c,t as l,u,w as d,y as f}from"./index-FG9feFxU.js";import{a as p,c as m,d as h,i as g,l as _,n as v,o as y,r as b,s as x,t as S,u as C}from"./PieChart-BYwjWGrq.js";var w=d(f(),1),T=c(),E=[`#0088FE`,`#00C49F`,`#FFBB28`,`#FF8042`,`#8884d8`];function D(){let[e,r]=(0,w.useState)(null),[c,l]=(0,w.useState)(!0),[d,f]=(0,w.useState)(new Date().getFullYear()),[D,O]=(0,w.useState)(!1);(0,w.useEffect)(()=>{k()},[d]);let k=async()=>{try{r((await s.get(`/sa/analytics/dashboard`,{params:{year:d}})).data),l(!1)}catch(e){console.error(`Failed to fetch analytics`,e),u.error(`Failed to load analytics data`),l(!1)}},A=async e=>{O(!0);try{let t=e===`expiry`?`/sa/analytics/reports/expiry`:`/sa/analytics/reports/companies`,n=(await s.get(t)).data;if(!n||n.length===0){u(`No data available for report`);return}let r=`data:text/csv;charset=utf-8,${Object.keys(n[0]).join(`,`)}\n${n.map(e=>Object.values(e).map(e=>`"${e}"`).join(`,`)).join(`
`)}`,i=encodeURI(r),a=document.createElement(`a`);a.setAttribute(`href`,i),a.setAttribute(`download`,`${e}_report_${new Date().toISOString().split(`T`)[0]}.csv`),document.body.appendChild(a),a.click(),document.body.removeChild(a),u.success(`${e===`expiry`?`Expiry`:`Company`} report downloaded!`)}catch(e){console.error(`Report generation failed`,e),u.error(`Failed to generate report`)}finally{O(!1)}};if(c)return(0,T.jsx)(`div`,{className:`p-10 text-center animate-pulse text-slate-500`,children:`Loading platform analytics...`});if(!e)return(0,T.jsx)(`div`,{className:`p-10 text-center text-red-500`,children:`Failed to load analytics data. Please try again later.`});let j=e?.growth.map((e,t)=>({name:new Date(0,t).toLocaleString(`default`,{month:`short`}),companies:e})),M=e?.expiry.map((e,t)=>({name:new Date(0,t).toLocaleString(`default`,{month:`short`}),expiring:e}));return(0,T.jsxs)(`div`,{className:`space-y-8 max-w-7xl mx-auto`,children:[(0,T.jsxs)(`div`,{className:`flex flex-col md:flex-row justify-between items-end gap-4`,children:[(0,T.jsxs)(`div`,{children:[(0,T.jsxs)(`h1`,{className:`text-2xl font-bold text-slate-800`,children:[`Platform Analytics (`,d,`)`]}),(0,T.jsx)(`p`,{className:`text-sm text-slate-500 mt-1`,children:`Year-wise growth, subscription expiry, and system health.`})]}),(0,T.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,T.jsx)(`select`,{value:d,onChange:e=>f(parseInt(e.target.value)),className:`px-4 py-2 bg-white border border-slate-200 rounded-lg text-sm font-medium focus:outline-none focus:ring-2 focus:ring-blue-500`,children:[0,1,2,3].map(e=>(0,T.jsx)(`option`,{value:new Date().getFullYear()-e,children:new Date().getFullYear()-e},e))}),(0,T.jsxs)(`button`,{onClick:()=>A(`company`),disabled:D,className:`flex items-center gap-2 px-4 py-2 bg-white border border-slate-200 hover:bg-slate-50 text-slate-700 rounded-lg text-sm font-medium transition-colors`,children:[(0,T.jsx)(t,{size:16}),`Full Data Export`]}),(0,T.jsxs)(`button`,{onClick:()=>A(`expiry`),disabled:D,className:`flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm font-medium transition-colors shadow-sm`,children:[(0,T.jsx)(n,{size:16}),`Expiry Report`]})]})]}),(0,T.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-4 gap-6`,children:[(0,T.jsxs)(`div`,{className:`bg-white p-6 rounded-xl border border-slate-200 shadow-sm flex items-center gap-4`,children:[(0,T.jsx)(`div`,{className:`p-3 bg-blue-50 text-blue-600 rounded-lg`,children:(0,T.jsx)(o,{size:24})}),(0,T.jsxs)(`div`,{children:[(0,T.jsx)(`p`,{className:`text-sm text-slate-500`,children:`Total Companies`}),(0,T.jsx)(`h3`,{className:`text-2xl font-bold text-slate-800`,children:e.totalCompanies})]})]}),(0,T.jsxs)(`div`,{className:`bg-white p-6 rounded-xl border border-slate-200 shadow-sm flex items-center gap-4`,children:[(0,T.jsx)(`div`,{className:`p-3 bg-green-50 text-green-600 rounded-lg`,children:(0,T.jsx)(i,{size:24})}),(0,T.jsxs)(`div`,{children:[(0,T.jsx)(`p`,{className:`text-sm text-slate-500`,children:`Active Subscriptions`}),(0,T.jsx)(`h3`,{className:`text-2xl font-bold text-slate-800`,children:e.activeCompanies})]})]})]}),(0,T.jsxs)(`div`,{className:`grid grid-cols-1 lg:grid-cols-2 gap-6`,children:[(0,T.jsxs)(`div`,{className:`bg-white p-6 rounded-xl border border-slate-200 shadow-sm`,children:[(0,T.jsxs)(`h3`,{className:`text-lg font-semibold text-slate-800 mb-6 flex items-center gap-2`,children:[(0,T.jsx)(i,{size:18,className:`text-blue-500`}),`Company Growth (`,d,`)`]}),(0,T.jsx)(`div`,{className:`h-80`,children:(0,T.jsx)(h,{width:`100%`,height:`100%`,children:(0,T.jsxs)(v,{data:j,children:[(0,T.jsx)(y,{strokeDasharray:`3 3`,vertical:!1,stroke:`#E2E8F0`}),(0,T.jsx)(g,{dataKey:`name`,axisLine:!1,tickLine:!1,tick:{fill:`#64748B`,fontSize:12},dy:10}),(0,T.jsx)(b,{axisLine:!1,tickLine:!1,tick:{fill:`#64748B`,fontSize:12}}),(0,T.jsx)(_,{cursor:{fill:`#F1F5F9`},contentStyle:{borderRadius:`8px`,border:`none`,boxShadow:`0 4px 6px -1px rgb(0 0 0 / 0.1)`}}),(0,T.jsx)(p,{dataKey:`companies`,fill:`#3B82F6`,radius:[4,4,0,0],barSize:32})]})})})]}),(0,T.jsxs)(`div`,{className:`bg-white p-6 rounded-xl border border-slate-200 shadow-sm`,children:[(0,T.jsxs)(`h3`,{className:`text-lg font-semibold text-slate-800 mb-6 flex items-center gap-2`,children:[(0,T.jsx)(a,{size:18,className:`text-amber-500`}),`Subscription Expiry Forecast`]}),(0,T.jsx)(`div`,{className:`h-80`,children:(0,T.jsx)(h,{width:`100%`,height:`100%`,children:(0,T.jsxs)(v,{data:M,children:[(0,T.jsx)(y,{strokeDasharray:`3 3`,vertical:!1,stroke:`#E2E8F0`}),(0,T.jsx)(g,{dataKey:`name`,axisLine:!1,tickLine:!1,tick:{fill:`#64748B`,fontSize:12},dy:10}),(0,T.jsx)(b,{axisLine:!1,tickLine:!1,tick:{fill:`#64748B`,fontSize:12}}),(0,T.jsx)(_,{cursor:{fill:`#F1F5F9`},contentStyle:{borderRadius:`8px`,border:`none`,boxShadow:`0 4px 6px -1px rgb(0 0 0 / 0.1)`}}),(0,T.jsx)(p,{dataKey:`expiring`,fill:`#F59E0B`,radius:[4,4,0,0],barSize:32})]})})})]}),(0,T.jsxs)(`div`,{className:`bg-white p-6 rounded-xl border border-slate-200 shadow-sm lg:col-span-2`,children:[(0,T.jsx)(`h3`,{className:`text-lg font-semibold text-slate-800 mb-6`,children:`Subscription Status Distribution`}),(0,T.jsx)(`div`,{className:`flex flex-col md:flex-row items-center justify-around h-64`,children:(0,T.jsx)(h,{width:`100%`,height:`100%`,children:(0,T.jsxs)(S,{children:[(0,T.jsx)(x,{data:e.statusDistribution,cx:`50%`,cy:`50%`,innerRadius:80,outerRadius:120,paddingAngle:5,dataKey:`value`,children:e.statusDistribution.map((e,t)=>(0,T.jsx)(m,{fill:E[t%E.length]},`cell-${t}`))}),(0,T.jsx)(_,{}),(0,T.jsx)(C,{})]})})})]})]})]})}var O=[`#0088FE`,`#00C49F`,`#FFBB28`,`#FF8042`];function k(){let{user:e}=l();return e?.isSuperAdmin?(0,T.jsx)(D,{}):(0,T.jsx)(A,{})}function A(){let[t,n]=(0,w.useState)(null),[a,c]=(0,w.useState)(!0);if((0,w.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem(`companyId`);n((await s.get(`/analytics/dashboard`,{params:{companyId:e}})).data)}catch(e){console.error(`Failed to fetch analytics`,e)}finally{c(!1)}})()},[]),a)return(0,T.jsx)(`div`,{className:`p-10 text-center`,children:`Loading analytics...`});if(!t)return(0,T.jsx)(`div`,{className:`p-10 text-center text-slate-500`,children:`No data available or failed to load.`});let l=[{name:`Jan`,revenue:4e3,expenses:2400},{name:`Feb`,revenue:3e3,expenses:1398},{name:`Mar`,revenue:2e3,expenses:9800},{name:`Apr`,revenue:2780,expenses:3908},{name:`May`,revenue:1890,expenses:4800},{name:`Jun`,revenue:2390,expenses:3800}],u=[{name:`In Stock`,value:t.inventory?.totalItems||0},{name:`Low Stock`,value:t.inventory?.lowStock||0}];return(0,T.jsxs)(`div`,{className:`space-y-6`,children:[(0,T.jsx)(`h1`,{className:`text-2xl font-bold text-slate-800`,children:`Analytics & Reporting`}),(0,T.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-4 gap-6`,children:[(0,T.jsxs)(`div`,{className:`bg-white p-6 rounded-xl border border-slate-200 shadow-sm flex items-center gap-4`,children:[(0,T.jsx)(`div`,{className:`p-3 bg-blue-50 text-blue-600 rounded-lg`,children:(0,T.jsx)(o,{size:24})}),(0,T.jsxs)(`div`,{children:[(0,T.jsx)(`p`,{className:`text-sm text-slate-500`,children:`Total Employees`}),(0,T.jsx)(`h3`,{className:`text-2xl font-bold text-slate-800`,children:t.employees?.total||0})]})]}),(0,T.jsxs)(`div`,{className:`bg-white p-6 rounded-xl border border-slate-200 shadow-sm flex items-center gap-4`,children:[(0,T.jsx)(`div`,{className:`p-3 bg-green-50 text-green-600 rounded-lg`,children:(0,T.jsx)(e,{size:24})}),(0,T.jsxs)(`div`,{children:[(0,T.jsx)(`p`,{className:`text-sm text-slate-500`,children:`Total Expenses`}),(0,T.jsxs)(`h3`,{className:`text-2xl font-bold text-slate-800`,children:[`$`,t.finance?.totalExpenses||0]})]})]}),(0,T.jsxs)(`div`,{className:`bg-white p-6 rounded-xl border border-slate-200 shadow-sm flex items-center gap-4`,children:[(0,T.jsx)(`div`,{className:`p-3 bg-indigo-50 text-indigo-600 rounded-lg`,children:(0,T.jsx)(r,{size:24})}),(0,T.jsxs)(`div`,{children:[(0,T.jsx)(`p`,{className:`text-sm text-slate-500`,children:`Inventory Items`}),(0,T.jsx)(`h3`,{className:`text-2xl font-bold text-slate-800`,children:t.inventory?.totalItems||0})]})]}),(0,T.jsxs)(`div`,{className:`bg-white p-6 rounded-xl border border-slate-200 shadow-sm flex items-center gap-4`,children:[(0,T.jsx)(`div`,{className:`p-3 bg-purple-50 text-purple-600 rounded-lg`,children:(0,T.jsx)(i,{size:24})}),(0,T.jsxs)(`div`,{children:[(0,T.jsx)(`p`,{className:`text-sm text-slate-500`,children:`Customer Satisfaction`}),(0,T.jsxs)(`h3`,{className:`text-2xl font-bold text-slate-800`,children:[t.performance?.customerSatisfaction||0,`/10`]})]})]})]}),(0,T.jsxs)(`div`,{className:`grid grid-cols-1 lg:grid-cols-2 gap-6`,children:[(0,T.jsxs)(`div`,{className:`bg-white p-6 rounded-xl border border-slate-200 shadow-sm`,children:[(0,T.jsx)(`h3`,{className:`text-lg font-semibold text-slate-800 mb-4`,children:`Financial Overview`}),(0,T.jsx)(`div`,{className:`h-80`,children:(0,T.jsx)(h,{width:`100%`,height:`100%`,children:(0,T.jsxs)(v,{data:l,children:[(0,T.jsx)(y,{strokeDasharray:`3 3`}),(0,T.jsx)(g,{dataKey:`name`}),(0,T.jsx)(b,{}),(0,T.jsx)(_,{}),(0,T.jsx)(C,{}),(0,T.jsx)(p,{dataKey:`revenue`,fill:`#4F46E5`,name:`Revenue`}),(0,T.jsx)(p,{dataKey:`expenses`,fill:`#EF4444`,name:`Expenses`})]})})})]}),(0,T.jsxs)(`div`,{className:`bg-white p-6 rounded-xl border border-slate-200 shadow-sm`,children:[(0,T.jsx)(`h3`,{className:`text-lg font-semibold text-slate-800 mb-4`,children:`Inventory Status`}),(0,T.jsx)(`div`,{className:`h-80`,children:(0,T.jsx)(h,{width:`100%`,height:`100%`,children:(0,T.jsxs)(S,{children:[(0,T.jsx)(x,{data:u,cx:`50%`,cy:`50%`,innerRadius:60,outerRadius:100,fill:`#8884d8`,paddingAngle:5,dataKey:`value`,children:u.map((e,t)=>(0,T.jsx)(m,{fill:O[t%O.length]},`cell-${t}`))}),(0,T.jsx)(_,{}),(0,T.jsx)(C,{})]})})})]})]})]})}export{k as default};