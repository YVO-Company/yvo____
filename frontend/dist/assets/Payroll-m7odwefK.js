import{t as e}from"./circle-check-big-D3q_FoYY.js";import{t}from"./clock-p49MgRWf.js";import{t as n}from"./file-text-X3F31LPe.js";import{t as r}from"./trash-2-Eo-Zwxxt.js";import{c as i,n as a,r as o,w as s,y as c}from"./index-FG9feFxU.js";import{t as l}from"./html2pdf-CMpu4Xgi.js";var u=i(`badge-dollar-sign`,[[`path`,{d:`M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z`,key:`3c2336`}],[`path`,{d:`M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8`,key:`1h4pet`}],[`path`,{d:`M12 18V6`,key:`zqpxq5`}]]),d=i(`calculator`,[[`rect`,{width:`16`,height:`20`,x:`4`,y:`2`,rx:`2`,key:`1nb95v`}],[`line`,{x1:`8`,x2:`16`,y1:`6`,y2:`6`,key:`x4nwl0`}],[`line`,{x1:`16`,x2:`16`,y1:`14`,y2:`18`,key:`wjye3r`}],[`path`,{d:`M16 10h.01`,key:`1m94wz`}],[`path`,{d:`M12 10h.01`,key:`1nrarc`}],[`path`,{d:`M8 10h.01`,key:`19clt8`}],[`path`,{d:`M12 14h.01`,key:`1etili`}],[`path`,{d:`M8 14h.01`,key:`6423bh`}],[`path`,{d:`M12 18h.01`,key:`mhygvu`}],[`path`,{d:`M8 18h.01`,key:`lrp35t`}]]),f=s(c(),1),p=s(l(),1),m=o();function h(){let[i,o]=(0,f.useState)([]),[s,c]=(0,f.useState)([]),[l,h]=(0,f.useState)(!0),[g,_]=(0,f.useState)(!1),[v,y]=(0,f.useState)(null),[b,x]=(0,f.useState)({amount:``,bonus:0,payPeriod:``,paymentDate:new Date().toISOString().slice(0,10),remarks:``}),[S,C]=(0,f.useState)(null),[w,T]=(0,f.useState)(!1),E=async(e,t)=>{if(!(!e||!t)){T(!0);try{let n=t.split(` `);if(n.length!==2){T(!1);return}let r=n[0],i=n[1],o=new Date(`${r} 1, 2000`).getMonth()+1,s=await a.get(`/employees/${e}/calculate-salary`,{params:{month:o,year:i,bonus:b.bonus}});C(s.data),x(e=>({...e,amount:s.data.finalSalary}))}catch(e){console.error(`Calculation Error:`,e)}finally{T(!1)}}},[D,O]=(0,f.useState)(new Date().getMonth()+1),[k,A]=(0,f.useState)(new Date().getFullYear());(0,f.useEffect)(()=>{I()},[]);let j=e=>s.find(t=>{let n=new Date(t.paymentDate);return t.employeeId?._id===e&&n.getMonth()+1===D&&n.getFullYear()===k}),M=new Date(k,D-1).toLocaleString(`default`,{month:`long`,year:`numeric`}),N=i.reduce((e,t)=>e+(t.salary||0)/12,0),P=s.filter(e=>{let t=new Date(e.paymentDate);return t.getMonth()+1===D&&t.getFullYear()===k}).reduce((e,t)=>e+t.amount,0),F=Math.max(0,N-P),I=async()=>{try{let e=localStorage.getItem(`companyId`),[t,n]=await Promise.all([a.get(`/employees`,{params:{companyId:e}}),a.get(`/employees/salary-records`,{params:{companyId:e}})]);console.log(`Payroll Employees Fetched:`,t.data),console.log(`Payroll Salary Records Fetched:`,n.data),o(t.data),c(n.data)}catch(e){console.error(`Payroll Fetch Error:`,e)}finally{h(!1)}},L=e=>{let t=new Date(k,D-1).toLocaleString(`default`,{month:`long`,year:`numeric`});y(e),x({amount:e.salary?(e.salary/12).toFixed(2):``,payPeriod:t,paymentDate:new Date().toISOString().slice(0,10),remarks:`Monthly Salary`,bonus:0}),_(!0)},R=async e=>{e.preventDefault();try{await a.post(`/employees/${v._id}/pay`,{amount:b.amount,payPeriod:b.payPeriod,paymentDate:b.paymentDate,remarks:b.remarks,bonus:b.bonus,companyId:localStorage.getItem(`companyId`),...S,deductionAmount:S.deduction}),alert(`Salary Paid Successfully!`),_(!1),I()}catch(e){console.error(e),alert(`Failed to pay salary`)}},z=async e=>{if(window.confirm(`Are you sure you want to delete this salary record? This will revert the status to Pending.`))try{await a.delete(`/employees/salary-records/${e}`),I()}catch(e){console.error(`Failed to delete salary record`,e),alert(`Failed to delete salary record`)}},B=(e,t)=>{let n=document.createElement(`div`);n.innerHTML=`
            <div style="padding: 40px; font-family: sans-serif; max-width: 800px; margin: 0 auto; border: 1px solid #eee;">
                <h2 style="text-align: center; margin-bottom: 30px; color: #333;">PAYSLIP</h2>
                
                <div style="display: flex; justify-content: space-between; margin-bottom: 30px;">
                    <div>
                        <strong>Company Name</strong><br>
                        Address Line 1<br>
                        Address Line 2
                    </div>
                    <div style="text-align: right;">
                        <strong>Payslip For:</strong> ${t.payPeriod}<br>
                        <strong>Payment Date:</strong> ${new Date(t.paymentDate).toLocaleDateString()}
                    </div>
                </div>

                <div style="margin-bottom: 30px; border-bottom: 2px solid #eee; padding-bottom: 20px;">
                    <strong>Employee Details:</strong><br>
                    Name: ${e.firstName} ${e.lastName}<br>
                    Designation: ${e.position}<br>
                    Employee ID: ${e._id.slice(-6).toUpperCase()}
                </div>

                <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px;">
                    <thead>
                        <tr style="background-color: #f8f9fa;">
                            <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Description</th>
                            <th style="padding: 12px; text-align: right; border-bottom: 2px solid #ddd;">Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">Basic Salary</td>
                            <td style="padding: 12px; text-align: right; border-bottom: 1px solid #eee;">₹${t.baseSalary?.toLocaleString()||(t.amount+(t.deductionAmount||0)).toLocaleString()}</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border-bottom: 1px solid #eee;">Bonus</td>
                            <td style="padding: 12px; text-align: right; border-bottom: 1px solid #eee; color: #16a34a;">+ ₹${(t.bonus||0).toLocaleString()}</td>
                        </tr>
                        ${t.deductionAmount>0?`
                        <tr>
                            <td style="padding: 12px; border-bottom: 1px solid #eee; color: #dc2626;">Deductions (Leaves)</td>
                            <td style="padding: 12px; text-align: right; border-bottom: 1px solid #eee; color: #dc2626;">- ₹${t.deductionAmount.toLocaleString()}</td>
                        </tr>
                        `:``}
                        <tr style="font-weight: bold; background-color: #f8f9fa;">
                            <td style="padding: 12px; border-bottom: 1px solid #ddd;">Net Payable</td>
                            <td style="padding: 12px; text-align: right; border-bottom: 1px solid #ddd;">₹${t.amount.toLocaleString()}</td>
                        </tr>
                    </tbody>
                </table>

                <div style="margin-top: 50px; text-align: center; font-size: 12px; color: #666;">
                    This is a computer-generated payslip and does not require a signature.
                </div>
            </div>
        `,(0,p.default)().from(n).save(`Payslip_${e.firstName}_${t.payPeriod}.pdf`)};return l?(0,m.jsx)(`div`,{className:`p-10 text-center`,children:`Loading Payroll...`}):(0,m.jsxs)(`div`,{className:`space-y-6`,children:[(0,m.jsxs)(`div`,{className:`flex justify-between items-center`,children:[(0,m.jsxs)(`div`,{children:[(0,m.jsx)(`h1`,{className:`text-2xl font-bold text-slate-800`,children:`Payroll Management`}),(0,m.jsxs)(`p`,{className:`text-sm text-slate-500`,children:[`Manage salaries for `,M]})]}),(0,m.jsx)(`div`,{className:`flex gap-4`,children:(0,m.jsxs)(`div`,{className:`flex items-center gap-2 bg-white border border-slate-200 rounded-lg p-1`,children:[(0,m.jsx)(`button`,{onClick:()=>{D===1?(O(12),A(e=>e-1)):O(e=>e-1)},className:`p-1 hover:bg-slate-100 rounded`,children:`<`}),(0,m.jsx)(`span`,{className:`text-sm font-semibold w-32 text-center`,children:M}),(0,m.jsx)(`button`,{onClick:()=>{D===12?(O(1),A(e=>e+1)):O(e=>e+1)},className:`p-1 hover:bg-slate-100 rounded`,children:`>`})]})})]}),(0,m.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-3 gap-4`,children:[(0,m.jsxs)(`div`,{className:`bg-white p-4 rounded-xl border border-slate-200 shadow-sm`,children:[(0,m.jsx)(`div`,{className:`text-sm text-slate-500`,children:`Total Liability`}),(0,m.jsxs)(`div`,{className:`text-2xl font-bold text-slate-900`,children:[`₹`,N.toLocaleString(void 0,{maximumFractionDigits:0})]})]}),(0,m.jsxs)(`div`,{className:`bg-white p-4 rounded-xl border border-slate-200 shadow-sm`,children:[(0,m.jsx)(`div`,{className:`text-sm text-slate-500`,children:`Paid this Month`}),(0,m.jsxs)(`div`,{className:`text-2xl font-bold text-emerald-600`,children:[`₹`,P.toLocaleString(void 0,{maximumFractionDigits:0})]})]}),(0,m.jsxs)(`div`,{className:`bg-white p-4 rounded-xl border border-slate-200 shadow-sm`,children:[(0,m.jsx)(`div`,{className:`text-sm text-slate-500`,children:`Pending Amount`}),(0,m.jsxs)(`div`,{className:`text-2xl font-bold text-orange-600`,children:[`₹`,F.toLocaleString(void 0,{maximumFractionDigits:0})]})]})]}),(0,m.jsx)(`div`,{className:`bg-white rounded-xl border border-slate-200 overflow-hidden shadow-sm overflow-x-auto`,children:(0,m.jsxs)(`table`,{className:`w-full text-left text-sm`,children:[(0,m.jsx)(`thead`,{className:`bg-slate-50 text-slate-500 font-medium border-b border-slate-200`,children:(0,m.jsxs)(`tr`,{children:[(0,m.jsx)(`th`,{className:`px-6 py-4`,children:`Employee`}),(0,m.jsx)(`th`,{className:`px-6 py-4`,children:`Position`}),(0,m.jsx)(`th`,{className:`px-6 py-4`,children:`Annual Salary`}),(0,m.jsx)(`th`,{className:`px-6 py-4`,children:`Monthly (Approx)`}),(0,m.jsx)(`th`,{className:`px-6 py-4 text-center`,children:`Status`}),(0,m.jsx)(`th`,{className:`px-6 py-4 text-center`,children:`Action`})]})}),(0,m.jsx)(`tbody`,{className:`divide-y divide-slate-100`,children:i.filter(e=>{let t=new Date(k,D,0);return new Date(e.dateHired)<=t}).map(i=>{let a=j(i._id),o=!!a;return(0,m.jsxs)(`tr`,{className:`hover:bg-slate-50`,children:[(0,m.jsx)(`td`,{className:`px-6 py-4 font-medium text-slate-900`,children:(0,m.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,m.jsxs)(`div`,{className:`w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center font-bold text-xs`,children:[i.firstName[0],i.lastName[0]]}),i.firstName,` `,i.lastName]})}),(0,m.jsx)(`td`,{className:`px-6 py-4 text-slate-600`,children:i.position}),(0,m.jsxs)(`td`,{className:`px-6 py-4 text-slate-900 font-medium`,children:[`₹`,i.salary?.toLocaleString()]}),(0,m.jsxs)(`td`,{className:`px-6 py-4 text-emerald-600 font-medium`,children:[`₹`,(i.salary/12).toLocaleString(void 0,{maximumFractionDigits:2})]}),(0,m.jsx)(`td`,{className:`px-6 py-4 text-center`,children:o?(0,m.jsxs)(`span`,{className:`inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800`,children:[(0,m.jsx)(e,{size:12}),` Paid`]}):(0,m.jsxs)(`span`,{className:`inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-800`,children:[(0,m.jsx)(t,{size:12}),` Pending`]})}),(0,m.jsx)(`td`,{className:`px-6 py-4 text-center`,children:o?(0,m.jsxs)(`div`,{className:`flex items-center justify-center gap-2`,children:[(0,m.jsx)(`button`,{onClick:()=>B(i,a),className:`p-1.5 text-slate-500 hover:text-indigo-600 hover:bg-slate-100 rounded-lg transition`,title:`View Slip`,children:(0,m.jsx)(n,{size:16})}),(0,m.jsx)(`button`,{onClick:()=>z(a._id),className:`p-1.5 text-slate-500 hover:text-red-600 hover:bg-red-50 rounded-lg transition`,title:`Revert Payment`,children:(0,m.jsx)(r,{size:16})})]}):(0,m.jsxs)(`button`,{onClick:()=>L(i),className:`inline-flex items-center gap-2 px-3 py-1.5 bg-indigo-600 text-white rounded-lg text-xs font-medium hover:bg-indigo-700 transition`,children:[(0,m.jsx)(u,{size:14}),` Pay`]})})]},i._id)})})]})}),g&&(0,m.jsx)(`div`,{className:`fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4`,children:(0,m.jsxs)(`div`,{className:`bg-white rounded-xl shadow-xl w-full max-w-md animate-in fade-in zoom-in duration-200`,children:[(0,m.jsxs)(`div`,{className:`p-6 border-b border-slate-100 bg-slate-50/50`,children:[(0,m.jsx)(`h2`,{className:`text-lg font-bold text-slate-800`,children:`Process Salary Payment`}),(0,m.jsxs)(`p`,{className:`text-sm text-slate-500`,children:[`For `,v?.firstName,` `,v?.lastName]})]}),(0,m.jsxs)(`form`,{onSubmit:R,className:`p-6 space-y-4`,children:[(0,m.jsxs)(`div`,{className:`flex gap-2`,children:[(0,m.jsxs)(`div`,{className:`flex-1`,children:[(0,m.jsx)(`label`,{className:`text-xs font-semibold text-slate-500 mb-1 block`,children:`Pay Period`}),(0,m.jsx)(`input`,{required:!0,className:`w-full border border-slate-200 p-2 rounded-lg`,value:b.payPeriod,onChange:e=>x({...b,payPeriod:e.target.value}),placeholder:`e.g. October 2023`,onBlur:()=>E(v._id,b.payPeriod)})]}),(0,m.jsxs)(`div`,{className:`flex-1`,children:[(0,m.jsx)(`label`,{className:`text-xs font-semibold text-slate-500 mb-1 block`,children:`Bonus (₹)`}),(0,m.jsx)(`input`,{type:`number`,className:`w-full border border-slate-200 p-2 rounded-lg`,value:b.bonus,onChange:e=>{let t=Number(e.target.value);x(e=>{let n=(S?S.baseSalary:Number(e.amount)-e.bonus)+t;return{...e,bonus:t,amount:n}}),S&&C(e=>({...e,finalSalary:S.baseSalary+t}))}})]}),(0,m.jsx)(`div`,{className:`flex items-end mb-1`,children:(0,m.jsx)(`button`,{type:`button`,onClick:()=>E(v._id,b.payPeriod),className:`p-2 bg-indigo-50 text-indigo-600 rounded-lg hover:bg-indigo-100`,title:`Recalculate`,children:(0,m.jsx)(d,{size:18})})})]}),w?(0,m.jsx)(`div`,{className:`text-center py-4 text-sm text-slate-500`,children:`Calculating deductions...`}):S?(0,m.jsxs)(`div`,{className:`bg-slate-50 p-3 rounded-lg border border-slate-200 text-sm space-y-1`,children:[(0,m.jsxs)(`div`,{className:`flex justify-between`,children:[(0,m.jsx)(`span`,{className:`text-slate-500`,children:`Base Monthly Salary:`}),(0,m.jsxs)(`span`,{className:`font-medium`,children:[`₹`,S.baseSalary.toLocaleString()]})]}),(0,m.jsxs)(`div`,{className:`flex justify-between text-slate-500`,children:[(0,m.jsx)(`span`,{children:`Leaves Taken:`}),(0,m.jsxs)(`span`,{children:[S.totalLeaves,` days`]})]}),(0,m.jsxs)(`div`,{className:`flex justify-between text-slate-500`,children:[(0,m.jsx)(`span`,{children:`Free Leaves:`}),(0,m.jsxs)(`span`,{children:[S.freeLeaves,` days`]})]}),(0,m.jsxs)(`div`,{className:`flex justify-between text-slate-500`,children:[(0,m.jsx)(`span`,{children:`Working Days (Avg):`}),(0,m.jsxs)(`span`,{children:[S.workingDaysUsed,` days`]})]}),(0,m.jsxs)(`div`,{className:`flex justify-between text-emerald-600`,children:[(0,m.jsx)(`span`,{children:`Bonus:`}),(0,m.jsxs)(`span`,{children:[`+ ₹`,b.bonus.toLocaleString()]})]}),(0,m.jsxs)(`div`,{className:`flex justify-between text-red-600`,children:[(0,m.jsxs)(`span`,{children:[`Deduction (`,S.chargeableLeaves,` days):`]}),(0,m.jsxs)(`span`,{children:[`- ₹`,S.deduction.toLocaleString()]})]}),(0,m.jsxs)(`div`,{className:`border-t border-slate-200 pt-1 mt-1 flex justify-between font-bold text-slate-900`,children:[(0,m.jsx)(`span`,{children:`Net Payable:`}),(0,m.jsxs)(`span`,{children:[`₹`,S.finalSalary.toLocaleString()]})]})]}):null,(0,m.jsxs)(`div`,{children:[(0,m.jsx)(`label`,{className:`text-xs font-semibold text-slate-500 mb-1 block`,children:`Payment Date`}),(0,m.jsx)(`input`,{required:!0,type:`date`,className:`w-full border border-slate-200 p-2 rounded-lg`,value:b.paymentDate,onChange:e=>x({...b,paymentDate:e.target.value})})]}),(0,m.jsxs)(`div`,{children:[(0,m.jsx)(`label`,{className:`text-xs font-semibold text-slate-500 mb-1 block`,children:`Final Amount (₹)`}),(0,m.jsx)(`input`,{required:!0,type:`number`,className:`w-full border border-slate-200 p-2 rounded-lg font-semibold text-slate-900`,value:b.amount,onChange:e=>x({...b,amount:e.target.value})})]}),(0,m.jsxs)(`div`,{children:[(0,m.jsx)(`label`,{className:`text-xs font-semibold text-slate-500 mb-1 block`,children:`Remarks`}),(0,m.jsx)(`input`,{className:`w-full border border-slate-200 p-2 rounded-lg`,value:b.remarks,onChange:e=>x({...b,remarks:e.target.value})})]}),(0,m.jsxs)(`div`,{className:`flex justify-end gap-3 pt-4 border-t border-slate-100`,children:[(0,m.jsx)(`button`,{type:`button`,onClick:()=>_(!1),className:`px-4 py-2 text-slate-600 hover:bg-slate-50 rounded-lg text-sm font-medium`,children:`Cancel`}),(0,m.jsx)(`button`,{type:`submit`,className:`px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-medium`,children:`Confirm Payment`})]})]})]})})]})}export{h as default};