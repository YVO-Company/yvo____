import{t as e}from"./message-square-CVnSaj1a.js";import{t}from"./trash-2-Eo-Zwxxt.js";import{t as n}from"./users-Bws8m-qo.js";import{c as r,i,l as a,n as o,r as s,w as c,y as l}from"./index-FG9feFxU.js";var u=r(`send`,[[`path`,{d:`M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z`,key:`1ffxy3`}],[`path`,{d:`m21.854 2.147-10.94 10.939`,key:`12cjpa`}]]),d=c(l(),1),f=s();function p(){let[r,s]=(0,d.useState)(`compose`),[c,l]=(0,d.useState)([]),[p,m]=(0,d.useState)([]),[h,g]=(0,d.useState)(!1),_=localStorage.getItem(`companyId`),[v,y]=(0,d.useState)(!1),[b,x]=(0,d.useState)(null),[S,C]=(0,d.useState)(``),[w,T]=(0,d.useState)(``),[E,D]=(0,d.useState)(``),[O,k]=(0,d.useState)(`all`);(0,d.useEffect)(()=>{_&&(A(),j())},[_]);let A=async()=>{try{let{data:e}=await o.get(`/employees/groups?companyId=${_}`);l(Array.isArray(e)?e:[])}catch(e){console.error(`Failed to fetch groups`,e),a.error(`Failed to load groups`)}},j=async()=>{try{let{data:e}=await o.get(`/employees?companyId=${_}`);Array.isArray(e)&&m(e.map(e=>({id:e._id,name:`${e.firstName} ${e.lastName}`,firstName:e.firstName,lastName:e.lastName})))}catch(e){console.error(`Failed to fetch employees`,e)}},M=async e=>{if(e.preventDefault(),S.trim())try{let{data:e}=await o.post(`/employees/groups`,{companyId:_,name:S,members:[]});l(t=>[e,...t]),C(``),y(!1),a.success(`Group created successfully`)}catch(e){console.error(e),a.error(`Failed to create group`)}},N=async e=>{if(window.confirm(`Are you sure you want to delete this group? This action cannot be undone.`))try{await o.delete(`/employees/groups/${e}`),l(t=>t.filter(t=>t._id!==e)),b?._id===e&&x(null),a.success(`Group deleted`)}catch(e){console.error(e),a.error(`Failed to delete group`)}},P=async()=>{if(!w||!b)return;let e=b.members||[];if(e.some(e=>e._id===w)){a.error(`Member already in group`);return}let t=p.find(e=>e.id===w);if(!t)return;let n={_id:t.id,firstName:t.firstName,lastName:t.lastName},r={...b,members:[...e,n]};x(r);try{let e=r.members.map(e=>e._id),{data:t}=await o.put(`/employees/groups/${b._id}`,{name:b.name,members:e});l(e=>e.map(e=>e._id===b._id?t:e)),x(t),T(``),a.success(`Member added`)}catch(e){if(console.error(e),a.error(`Failed to add member`),A(),b){let e=c.find(e=>e._id===b._id);e&&x(e)}}},F=async e=>{if(!b||!window.confirm(`Remove this member?`))return;let t=(b.members||[]).filter(t=>t._id!==e);x({...b,members:t});try{let e=t.map(e=>e._id),{data:n}=await o.put(`/employees/groups/${b._id}`,{name:b.name,members:e});l(e=>e.map(e=>e._id===b._id?n:e)),x(n),a.success(`Member removed`)}catch(e){console.error(e),a.error(`Failed to remove member`),A()}};return(0,f.jsxs)(`div`,{className:`space-y-6`,children:[(0,f.jsx)(`h1`,{className:`text-2xl font-bold text-slate-800`,children:`Broadcast Center`}),(0,f.jsxs)(`div`,{className:`flex gap-6 border-b border-slate-200`,children:[(0,f.jsx)(`button`,{onClick:()=>s(`compose`),className:`pb-3 text-sm font-medium transition-colors ${r===`compose`?`border-b-2 border-blue-600 text-blue-600`:`text-slate-500 hover:text-slate-700`}`,children:`Compose Message`}),(0,f.jsx)(`button`,{onClick:()=>s(`groups`),className:`pb-3 text-sm font-medium transition-colors ${r===`groups`?`border-b-2 border-blue-600 text-blue-600`:`text-slate-500 hover:text-slate-700`}`,children:`Manage Groups`})]}),r===`compose`&&(0,f.jsxs)(`div`,{className:`max-w-3xl bg-white p-8 rounded-xl border border-slate-200 shadow-sm`,children:[(0,f.jsxs)(`h3`,{className:`text-lg font-semibold text-slate-800 mb-6 flex items-center gap-2`,children:[(0,f.jsx)(e,{size:20,className:`text-blue-600`}),`Send Broadcast`]}),(0,f.jsxs)(`form`,{className:`space-y-6`,children:[(0,f.jsxs)(`div`,{children:[(0,f.jsx)(`label`,{className:`block text-sm font-medium text-slate-700 mb-2`,children:`Recipient Group`}),(0,f.jsxs)(`select`,{value:O,onChange:e=>k(e.target.value),className:`w-full rounded-lg border border-slate-300 p-3 bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all`,children:[(0,f.jsx)(`option`,{value:`all`,children:`All Employees`}),c.map(e=>(0,f.jsxs)(`option`,{value:e._id,children:[e.name,` (`,e.members?.length||0,` members)`]},e._id))]})]}),(0,f.jsxs)(`div`,{children:[(0,f.jsx)(`label`,{className:`block text-sm font-medium text-slate-700 mb-2`,children:`Message Content`}),(0,f.jsx)(`textarea`,{value:E,onChange:e=>D(e.target.value),className:`w-full rounded-lg border border-slate-300 p-4 h-40 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all resize-none`,placeholder:`Type your message here...`})]}),(0,f.jsx)(`div`,{className:`flex justify-end pt-2`,children:(0,f.jsxs)(`button`,{type:`button`,onClick:async()=>{if(!E.trim()){a.error(`Please enter a message`);return}let e=localStorage.getItem(`user`),t=e?JSON.parse(e):null,n=t?._id||t?.id;if(!n){a.error(`User not authenticated properly`);return}try{await o.post(`/employees/send-message`,{companyId:_,senderId:n,groupId:O===`all`?null:O,targetAll:O===`all`,content:E,attachments:[]}),D(``),k(`all`),a.success(`Broadcast sent successfully`)}catch(e){console.error(`Failed to send message:`,e),a.error(`Failed to send broadcast`)}},className:`flex items-center gap-2 bg-blue-600 text-white px-6 py-2.5 rounded-lg hover:bg-blue-700 transition-colors shadow-sm font-medium`,children:[(0,f.jsx)(u,{size:18}),` Send Broadcast`]})})]})]}),r===`groups`&&(0,f.jsxs)(`div`,{className:`bg-white p-6 rounded-xl border border-slate-200 shadow-sm min-h-[500px]`,children:[(0,f.jsxs)(`div`,{className:`flex justify-between items-center mb-6`,children:[(0,f.jsxs)(`h3`,{className:`text-lg font-semibold text-slate-800 flex items-center gap-2`,children:[(0,f.jsx)(n,{size:20,className:`text-blue-600`}),`Employee Groups`]}),(0,f.jsx)(`button`,{onClick:()=>y(!0),className:`text-sm bg-blue-50 text-blue-600 px-4 py-2 rounded-lg hover:bg-blue-100 transition-colors font-medium flex items-center gap-2`,children:`+ Create New Group`})]}),v&&(0,f.jsxs)(`div`,{className:`mb-6 p-5 bg-slate-50 rounded-xl border border-slate-200 animate-in fade-in slide-in-from-top-2`,children:[(0,f.jsx)(`h4`,{className:`text-sm font-semibold text-slate-700 mb-3`,children:`Create New Group`}),(0,f.jsxs)(`form`,{onSubmit:M,className:`flex gap-3`,children:[(0,f.jsx)(`input`,{type:`text`,value:S,onChange:e=>C(e.target.value),placeholder:`Enter group name (e.g. Marketing Team)`,className:`flex-1 rounded-lg border border-slate-300 px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500`,autoFocus:!0}),(0,f.jsx)(`button`,{type:`submit`,className:`bg-blue-600 text-white px-5 py-2.5 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors`,children:`Create`}),(0,f.jsx)(`button`,{type:`button`,onClick:()=>y(!1),className:`bg-white text-slate-600 px-5 py-2.5 rounded-lg text-sm font-medium border border-slate-300 hover:bg-slate-50 transition-colors`,children:`Cancel`})]})]}),(0,f.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2 lg:grid-cols-3`,children:[c.map(e=>(0,f.jsxs)(`div`,{onClick:()=>x(e),className:`group relative p-5 border border-slate-200 rounded-xl hover:border-blue-300 hover:shadow-md transition-all cursor-pointer bg-white`,children:[(0,f.jsxs)(`div`,{className:`flex justify-between items-start mb-2`,children:[(0,f.jsx)(`h4`,{className:`font-semibold text-slate-800 text-lg`,children:e.name}),(0,f.jsx)(`span`,{className:`bg-slate-100 text-slate-600 text-xs px-2 py-1 rounded-full font-medium`,children:e.members?.length||0})]}),(0,f.jsx)(`p`,{className:`text-sm text-slate-500 line-clamp-1`,children:e.members&&e.members.length>0?e.members.map(e=>e.firstName).join(`, `):`No members yet`})]},e._id)),c.length===0&&!h&&(0,f.jsxs)(`div`,{className:`col-span-full py-12 text-center text-slate-400`,children:[(0,f.jsx)(n,{size:48,className:`mx-auto mb-3 opacity-20`}),(0,f.jsx)(`p`,{children:`No groups found. Create one to get started.`})]})]})]}),b&&(0,f.jsx)(`div`,{className:`fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center p-4 z-50 animate-in fade-in duration-200`,children:(0,f.jsxs)(`div`,{className:`bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden flex flex-col max-h-[85vh]`,children:[(0,f.jsxs)(`div`,{className:`p-5 border-b border-slate-100 flex justify-between items-center bg-slate-50`,children:[(0,f.jsxs)(`div`,{children:[(0,f.jsx)(`h3`,{className:`font-bold text-lg text-slate-800`,children:b.name}),(0,f.jsx)(`p`,{className:`text-xs text-slate-500 mt-0.5`,children:`Manage group members`})]}),(0,f.jsx)(`button`,{onClick:()=>x(null),className:`p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-200 rounded-full transition-colors`,children:(0,f.jsx)(i,{size:20})})]}),(0,f.jsxs)(`div`,{className:`p-6 flex-1 overflow-y-auto`,children:[(0,f.jsxs)(`div`,{className:`bg-blue-50/50 p-4 rounded-xl border border-blue-100 mb-6`,children:[(0,f.jsx)(`label`,{className:`block text-xs font-bold text-blue-800 uppercase tracking-wide mb-2`,children:`Add New Member`}),(0,f.jsxs)(`div`,{className:`flex gap-2`,children:[(0,f.jsxs)(`select`,{value:w,onChange:e=>T(e.target.value),className:`flex-1 rounded-lg border border-slate-300 text-sm p-2.5 focus:ring-2 focus:ring-blue-500 outline-none bg-white`,children:[(0,f.jsx)(`option`,{value:``,children:`Select Employee...`}),p.filter(e=>!b.members?.some(t=>t._id===e.id)).map(e=>(0,f.jsx)(`option`,{value:e.id,children:e.name},e.id))]}),(0,f.jsx)(`button`,{onClick:P,disabled:!w,className:`bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors`,children:`Add`})]})]}),(0,f.jsxs)(`div`,{children:[(0,f.jsxs)(`h4`,{className:`text-sm font-semibold text-slate-700 mb-3 flex items-center justify-between`,children:[`Current Members`,(0,f.jsx)(`span`,{className:`text-xs font-normal text-slate-500 bg-slate-100 px-2 py-0.5 rounded-full`,children:b.members?.length||0})]}),(0,f.jsx)(`div`,{className:`space-y-2`,children:!b.members||b.members.length===0?(0,f.jsx)(`div`,{className:`text-sm text-slate-400 italic py-8 text-center border-2 border-dashed border-slate-100 rounded-xl`,children:`No members in this group yet.`}):b.members.map(e=>(0,f.jsxs)(`div`,{className:`flex justify-between items-center p-3 hover:bg-slate-50 rounded-lg border border-transparent hover:border-slate-100 transition-colors group`,children:[(0,f.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,f.jsxs)(`div`,{className:`w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 text-xs font-bold`,children:[e.firstName?.[0],e.lastName?.[0]]}),(0,f.jsxs)(`span`,{className:`text-sm font-medium text-slate-700`,children:[e.firstName,` `,e.lastName]})]}),(0,f.jsx)(`button`,{onClick:t=>{t.stopPropagation(),F(e._id)},className:`text-red-500 opacity-0 group-hover:opacity-100 hover:text-red-700 p-2 hover:bg-red-50 rounded-lg transition-all`,title:`Remove Member`,children:(0,f.jsx)(t,{size:16})})]},e._id))})]})]}),(0,f.jsxs)(`div`,{className:`p-4 border-t border-slate-100 bg-slate-50 flex justify-between items-center`,children:[(0,f.jsx)(`button`,{onClick:()=>N(b._id),className:`text-red-600 text-sm hover:text-red-700 font-medium hover:underline px-2`,children:`Delete Group`}),(0,f.jsx)(`button`,{onClick:()=>x(null),className:`bg-white border border-slate-300 text-slate-700 px-5 py-2 rounded-lg text-sm font-medium hover:bg-slate-50 transition-colors shadow-sm`,children:`Close`})]})]})})]})}export{p as default};