import{t as e}from"./building-2-D7dfKyhA.js";import{t}from"./circle-alert-B9Shl7V1.js";import{t as n}from"./circle-check-big-D3q_FoYY.js";import{t as r}from"./clock-p49MgRWf.js";import{t as i}from"./database-BRdzMIiP.js";import{t as a}from"./dollar-sign-Dpwxw7ZW.js";import{t as o}from"./download-DkTWPRZE.js";import{t as s}from"./file-text-X3F31LPe.js";import{t as c}from"./loader-circle-CekiQCzI.js";import{t as l}from"./receipt-5-lLT31b.js";import{t as u}from"./users-Bws8m-qo.js";import{_ as d,n as f,r as p,u as m,w as h,y as g}from"./index-FG9feFxU.js";import{t as _}from"./html2pdf-CMpu4Xgi.js";var v=h(g(),1),y=h(_(),1),b=p();function x(){let[t]=d(),n=t.get(`companyId`),[s,p]=(0,v.useState)([]),[h,g]=(0,v.useState)(!0),[_,x]=(0,v.useState)(!1),[w,T]=(0,v.useState)([]),[E,D]=(0,v.useState)(n||localStorage.getItem(`companyId`)||``),[O,k]=(0,v.useState)(!1),[A,j]=(0,v.useState)({dateRange:`all`,includeFiles:!0,includePII:!1,modules:[]}),[M,N]=(0,v.useState)(null);(0,v.useEffect)(()=>{let e=JSON.parse(localStorage.getItem(`user`)||`{}`),t=e.role===`SUPER_ADMIN`||e.isSuperAdmin;k(t),t&&P(),E?(I(),F()):g(!1)},[E]);let P=async()=>{try{T((await f.get(`/sa/companies`,{params:{limit:100}})).data.companies||[])}catch{console.error(`Failed to fetch companies`)}};(0,v.useEffect)(()=>{if(s.some(e=>e.status===`QUEUED`||e.status===`PROCESSING`)){let e=setInterval(I,5e3);return()=>clearInterval(e)}},[s]);let F=async()=>{if(E)try{N((await f.get(`/company/config`,{headers:{"x-company-id":E}})).data.company)}catch{console.error(`Failed to load company config`)}},I=async()=>{if(E)try{p((await f.get(`/backups`,{headers:{"x-company-id":E}})).data)}catch(e){console.error(`Failed to fetch backups`,e)}finally{g(!1)}},L=async()=>{if(!E)return m.error(`Please select a company first`);try{x(!0),p([(await f.post(`/backups`,{filters:A},{headers:{"x-company-id":E}})).data,...s]),m.success(`Backup job started!`)}catch{m.error(`Failed to start backup`)}finally{x(!1)}},R=async(e,t)=>{if(E)try{m.loading(`Preparing download...`);let n=await f.get(`/backups/${e}/download`,{headers:{"x-company-id":E},responseType:`blob`}),r=window.URL.createObjectURL(new Blob([n.data])),i=document.createElement(`a`);i.href=r,i.setAttribute(`download`,t||`backup_${e}.zip`),document.body.appendChild(i),i.click(),i.remove(),window.URL.revokeObjectURL(r),m.dismiss(),m.success(`Download started`)}catch(e){console.error(`Download failed`,e),m.dismiss(),m.error(`Download failed. Your session might have expired.`)}},z=async e=>{if(window.confirm(`Are you sure you want to delete this backup?`))try{await f.delete(`/backups/${e}`,{headers:{"x-company-id":E}}),p(s.filter(t=>t._id!==e)),m.success(`Backup deleted`)}catch{m.error(`Failed to delete backup`)}},B=async()=>{if(!E)return m.error(`Select a company first`);try{m.loading(`Generating Finance Report...`);let[e,t]=await Promise.all([f.get(`/invoices`,{params:{companyId:E}}),f.get(`/expenses`,{params:{companyId:E}})]),n=t.data,r=e.data,i=document.createElement(`div`);i.style.padding=`20px`,i.innerHTML=`
                <div style="font-family: sans-serif;">
                    <h1 style="text-align: center;">Financial Report - ${M?.name||`YVO Company`}</h1>
                    <p style="text-align: center; color: #666;">Generated on ${new Date().toLocaleDateString()}</p>
                    <hr/>
                    <h3>Summary</h3>
                    <p>Total Revenue: ₹${r.filter(e=>e.status===`PAID`).reduce((e,t)=>e+(t.grandTotal||0),0)}</p>
                    <p>Total Expenses: ₹${n.reduce((e,t)=>e+(t.amount||0),0)}</p>
                    <hr/>
                    <h3>Expenses</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr style="background: #eee;">
                            <th style="border: 1px solid #ddd; padding: 8px;">Date</th>
                            <th style="border: 1px solid #ddd; padding: 8px;">Category</th>
                            <th style="border: 1px solid #ddd; padding: 8px;">Amount</th>
                        </tr>
                        ${n.map(e=>`
                            <tr>
                                <td style="border: 1px solid #ddd; padding: 8px;">${new Date(e.date).toLocaleDateString()}</td>
                                <td style="border: 1px solid #ddd; padding: 8px;">${e.category}</td>
                                <td style="border: 1px solid #ddd; padding: 8px;">₹${e.amount}</td>
                            </tr>
                        `).join(``)}
                    </table>
                </div>
            `,(0,y.default)().from(i).save(`Finance_Report_${new Date().toISOString().split(`T`)[0]}.pdf`),m.dismiss(),m.success(`Finance report downloaded`)}catch{m.dismiss(),m.error(`Failed to generate report`)}},V=async e=>{if(!E)return m.error(`Select a company first`);try{m.loading(`Generating ${e} report...`);let t=[],n=`report_${e}_${new Date().toISOString().split(`T`)[0]}.csv`;if(e===`payroll`?t=(await f.get(`/employees`,{params:{companyId:E}})).data.map(e=>({Name:`${e.firstName} ${e.lastName}`,Position:e.position,Salary:e.salary})):e===`revenue`&&(t=(await f.get(`/invoices`,{params:{companyId:E}})).data.filter(e=>e.status===`PAID`).map(e=>({Invoice:e.invoiceNumber,Client:e.customerName,Amount:e.grandTotal,Date:e.date}))),!t.length){m.dismiss(),m.error(`No data available`);return}let r=Object.keys(t[0]),i=[r.join(`,`),...t.map(e=>r.map(t=>`"${String(e[t]||``).replace(/"/g,`""`)}"`).join(`,`))].join(`
`),a=new Blob([i],{type:`text/csv`}),o=URL.createObjectURL(a),s=document.createElement(`a`);s.href=o,s.download=n,s.click(),m.dismiss(),m.success(`${e} report downloaded`)}catch{m.dismiss(),m.error(`Failed to generate CSV`)}};return(0,b.jsxs)(`div`,{className:`space-y-8 p-6 max-w-7xl mx-auto`,children:[(0,b.jsxs)(`div`,{className:`flex flex-col md:flex-row justify-between items-start md:items-center gap-6`,children:[(0,b.jsxs)(`div`,{children:[(0,b.jsx)(`h1`,{className:`text-3xl font-bold text-slate-800`,children:`Backup & Reports`}),(0,b.jsx)(`p`,{className:`text-slate-500 mt-2`,children:`Manage your company data exports and financial reports from one central location.`})]}),O&&(0,b.jsxs)(`div`,{className:`w-full md:w-64 bg-white p-4 rounded-xl border border-blue-100 shadow-sm flex flex-col gap-2`,children:[(0,b.jsx)(`label`,{className:`text-[10px] font-bold text-blue-600 uppercase tracking-wider`,children:`Select Company Context`}),(0,b.jsxs)(`select`,{className:`bg-slate-50 border border-slate-200 text-sm rounded-lg p-2 outline-none focus:ring-2 focus:ring-blue-500 transition-all font-medium`,value:E,onChange:e=>D(e.target.value),children:[(0,b.jsx)(`option`,{value:``,children:`-- Select Company --`}),w.map(e=>(0,b.jsx)(`option`,{value:e._id,children:e.name},e._id))]})]})]}),!E&&O?(0,b.jsxs)(`div`,{className:`bg-white rounded-2xl border-2 border-dashed border-slate-200 p-12 text-center flex flex-col items-center justify-center`,children:[(0,b.jsx)(`div`,{className:`p-4 bg-blue-50 text-blue-500 rounded-full mb-4`,children:(0,b.jsx)(e,{size:40})}),(0,b.jsx)(`h3`,{className:`text-xl font-bold text-slate-700`,children:`Please Select a Company`}),(0,b.jsx)(`p`,{className:`text-slate-500 max-w-sm mt-2`,children:`Select a company from the dropdown at the top right to manage its backups and reports.`})]}):(0,b.jsxs)(`div`,{className:`grid grid-cols-1 lg:grid-cols-3 gap-8`,children:[(0,b.jsxs)(`div`,{className:`lg:col-span-1 space-y-6`,children:[(0,b.jsxs)(`div`,{className:`bg-white p-6 rounded-2xl border border-slate-200 shadow-sm`,children:[(0,b.jsxs)(`h2`,{className:`text-xl font-bold text-slate-800 mb-6 flex items-center gap-2`,children:[(0,b.jsx)(i,{size:20,className:`text-indigo-600`}),` New Backup`]}),(0,b.jsxs)(`div`,{className:`space-y-4`,children:[(0,b.jsxs)(`div`,{children:[(0,b.jsx)(`label`,{className:`text-sm font-semibold text-slate-700 block mb-2`,children:`Date Range`}),(0,b.jsxs)(`select`,{className:`w-full bg-slate-50 border border-slate-200 rounded-lg p-3 text-sm`,value:A.dateRange,onChange:e=>j({...A,dateRange:e.target.value}),children:[(0,b.jsx)(`option`,{value:`all`,children:`Full Export (All Time)`}),(0,b.jsx)(`option`,{value:`last_7`,children:`Last 7 Days`}),(0,b.jsx)(`option`,{value:`last_30`,children:`Last 30 Days`}),(0,b.jsx)(`option`,{value:`last_90`,children:`Last 90 Days`})]})]}),(0,b.jsxs)(`div`,{className:`space-y-3`,children:[(0,b.jsxs)(`label`,{className:`flex items-center gap-3 p-3 bg-slate-50 rounded-xl cursor-not-allowed opacity-70`,children:[(0,b.jsx)(`input`,{type:`checkbox`,checked:!0,readOnly:!0,className:`rounded text-indigo-600`}),(0,b.jsx)(`span`,{className:`text-sm font-medium text-slate-700`,children:`Database Records (.json, .csv)`})]}),(0,b.jsxs)(`label`,{className:`flex items-center gap-3 p-3 bg-slate-50 rounded-xl cursor-pointer hover:bg-slate-100 transition`,children:[(0,b.jsx)(`input`,{type:`checkbox`,checked:A.includeFiles,onChange:e=>j({...A,includeFiles:e.target.checked}),className:`rounded text-indigo-600 focus:ring-indigo-500`}),(0,b.jsx)(`span`,{className:`text-sm font-medium text-slate-700`,children:`Include Uploaded Files`})]}),(0,b.jsxs)(`label`,{className:`flex items-center gap-3 p-3 bg-slate-50 rounded-xl cursor-pointer hover:bg-slate-100 transition`,children:[(0,b.jsx)(`input`,{type:`checkbox`,checked:A.includePII,onChange:e=>j({...A,includePII:e.target.checked}),className:`rounded text-indigo-600 focus:ring-indigo-500`}),(0,b.jsxs)(`div`,{className:`flex flex-col`,children:[(0,b.jsx)(`span`,{className:`text-sm font-medium text-slate-700`,children:`Include Personal Data (PII)`}),(0,b.jsx)(`span`,{className:`text-[10px] text-slate-400`,children:`Emails, Phone Numbers (unmasked)`})]})]})]}),(0,b.jsxs)(`button`,{onClick:L,disabled:_,className:`w-full py-4 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700 transition shadow-lg shadow-indigo-100 flex items-center justify-center gap-3 disabled:opacity-50 mt-4`,children:[_?(0,b.jsx)(c,{size:20,className:`animate-spin`}):(0,b.jsx)(o,{size:20}),`Generate Full Backup`]}),(0,b.jsx)(`p`,{className:`text-[11px] text-center text-slate-400`,children:`Backups are stored for 7 days before expiring.`})]})]}),(0,b.jsxs)(`div`,{className:`bg-gradient-to-br from-indigo-600 to-indigo-800 p-6 rounded-2xl text-white shadow-xl shadow-indigo-200`,children:[(0,b.jsx)(`h3`,{className:`font-bold text-lg mb-2`,children:`Quick Reports`}),(0,b.jsx)(`p`,{className:`text-indigo-100 text-sm mb-6`,children:`Instantly download specific summaries.`}),(0,b.jsxs)(`div`,{className:`space-y-3`,children:[(0,b.jsx)(S,{icon:(0,b.jsx)(l,{size:18}),label:`Finance Report (PDF)`,onClick:B}),(0,b.jsx)(S,{icon:(0,b.jsx)(u,{size:18}),label:`Payroll Export (CSV)`,onClick:()=>V(`payroll`)}),(0,b.jsx)(S,{icon:(0,b.jsx)(a,{size:18}),label:`Revenue Export (CSV)`,onClick:()=>V(`revenue`)})]})]})]}),(0,b.jsx)(`div`,{className:`lg:col-span-2`,children:(0,b.jsxs)(`div`,{className:`bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden min-h-[500px]`,children:[(0,b.jsxs)(`div`,{className:`p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50/50`,children:[(0,b.jsx)(`h2`,{className:`text-xl font-bold text-slate-800`,children:`Backup History`}),(0,b.jsx)(`button`,{onClick:I,className:`p-2 text-slate-400 hover:text-indigo-600 transition`,children:(0,b.jsx)(r,{size:20})})]}),h?(0,b.jsxs)(`div`,{className:`flex flex-col items-center justify-center h-[400px] text-slate-400`,children:[(0,b.jsx)(c,{size:40,className:`animate-spin mb-4`}),(0,b.jsx)(`span`,{children:`Loading your backups...`})]}):s.length>0?(0,b.jsx)(`div`,{className:`divide-y divide-slate-100`,children:s.map(e=>(0,b.jsx)(C,{backup:e,onDownload:()=>R(e._id,`backup_${e.backupId}.zip`),onDelete:()=>z(e._id)},e._id))}):(0,b.jsxs)(`div`,{className:`flex flex-col items-center justify-center h-[400px] text-center p-10`,children:[(0,b.jsx)(`div`,{className:`p-6 bg-slate-50 rounded-full mb-4`,children:(0,b.jsx)(i,{size:40,className:`text-slate-300`})}),(0,b.jsx)(`h3`,{className:`text-lg font-bold text-slate-700`,children:`No backups yet`}),(0,b.jsx)(`p`,{className:`text-slate-400 text-sm max-w-xs mt-2`,children:`Generate your first company backup to see it listed here.`})]})]})})]})]})}var S=({icon:e,label:t,onClick:n})=>(0,b.jsxs)(`button`,{onClick:n,className:`w-full flex items-center gap-3 p-3 bg-white/10 hover:bg-white/20 rounded-xl transition text-sm font-medium border border-white/10`,children:[e,(0,b.jsx)(`span`,{children:t})]}),C=({backup:e,onDownload:i,onDelete:a})=>{let l={QUEUED:(0,b.jsx)(r,{size:16,className:`text-amber-500`}),PROCESSING:(0,b.jsx)(c,{size:16,className:`text-indigo-500 animate-spin`}),READY:(0,b.jsx)(n,{size:16,className:`text-green-500`}),FAILED:(0,b.jsx)(t,{size:16,className:`text-red-500`}),EXPIRED:(0,b.jsx)(t,{size:16,className:`text-slate-400`})};return(0,b.jsxs)(`div`,{className:`p-6 hover:bg-slate-50/50 transition group`,children:[(0,b.jsxs)(`div`,{className:`flex items-start justify-between gap-4`,children:[(0,b.jsxs)(`div`,{className:`flex items-start gap-4`,children:[(0,b.jsx)(`div`,{className:`p-3 rounded-xl ${e.status===`READY`?`bg-green-50 text-green-600`:`bg-slate-100 text-slate-400`}`,children:(0,b.jsx)(s,{size:20})}),(0,b.jsxs)(`div`,{children:[(0,b.jsxs)(`div`,{className:`flex items-center gap-2 mb-1`,children:[(0,b.jsx)(`span`,{className:`font-bold text-slate-800`,children:e.backupId}),(0,b.jsxs)(`span`,{className:`flex items-center gap-1.5 px-2 py-0.5 rounded-full text-[10px] font-bold uppercase tracking-wider ${e.status===`READY`?`bg-green-100 text-green-700`:e.status===`FAILED`?`bg-red-100 text-red-700`:`bg-slate-100 text-slate-500`}`,children:[l[e.status],e.status]})]}),(0,b.jsxs)(`div`,{className:`text-xs text-slate-400 flex items-center gap-3`,children:[(0,b.jsx)(`span`,{children:new Date(e.createdAt).toLocaleString()}),e.fileSize&&(0,b.jsxs)(`span`,{children:[`• `,(e.fileSize/(1024*1024)).toFixed(2),` MB`]})]})]})]}),(0,b.jsxs)(`div`,{className:`flex items-center gap-2`,children:[e.status===`READY`&&(0,b.jsx)(`button`,{onClick:i,className:`p-2.5 bg-indigo-50 text-indigo-600 rounded-lg hover:bg-indigo-600 hover:text-white transition shadow-sm`,title:`Download ZIP`,children:(0,b.jsx)(o,{size:18})}),(0,b.jsx)(`button`,{onClick:a,className:`p-2.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition`,title:`Delete Backup`,children:(0,b.jsx)(t,{size:18})})]})]}),e.status===`PROCESSING`&&(0,b.jsxs)(`div`,{className:`mt-4`,children:[(0,b.jsxs)(`div`,{className:`flex justify-between text-[10px] text-slate-500 mb-1 font-medium`,children:[(0,b.jsxs)(`span`,{children:[`Processing `,e.currentModule||`data`,`...`]}),(0,b.jsxs)(`span`,{children:[e.progress,`%`]})]}),(0,b.jsx)(`div`,{className:`w-full bg-slate-100 h-1.5 rounded-full overflow-hidden`,children:(0,b.jsx)(`div`,{className:`bg-indigo-500 h-full transition-all duration-500`,style:{width:`${e.progress}%`}})})]}),e.status===`FAILED`&&e.error&&(0,b.jsxs)(`div`,{className:`mt-2 text-xs text-red-500 bg-red-50 p-2 rounded-lg border border-red-100`,children:[`Error: `,e.error]})]})};export{x as default};