import{t as e}from"./clock-p49MgRWf.js";import{t}from"./dollar-sign-Dpwxw7ZW.js";import{t as n}from"./download-DkTWPRZE.js";import{t as r}from"./file-text-X3F31LPe.js";import{t as i}from"./funnel-c-HQwwNE.js";import{t as a}from"./plus-CEMkcid2.js";import{t as o}from"./receipt-5-lLT31b.js";import{t as s}from"./trending-up-DzsNZMSM.js";import{m as c,n as l,r as u,w as d,y as f}from"./index-FG9feFxU.js";import{t as p}from"./html2pdf-CMpu4Xgi.js";var m=d(f(),1),h=d(p(),1),g=u();function _(){let u=c(),[d,f]=(0,m.useState)([]),[p,_]=(0,m.useState)([]),[y,b]=(0,m.useState)([]),[x,S]=(0,m.useState)({revenue:0,outstanding:0,expenses:0,profit:0}),[C,w]=(0,m.useState)(!0),[T,E]=(0,m.useState)(!1),[D,O]=(0,m.useState)({category:``,amount:``,description:``,paymentMethod:`Card`}),[k,A]=(0,m.useState)({dateRange:`this_month`,category:`all`}),[j,M]=(0,m.useState)(null);(0,m.useEffect)(()=>{P(),N()},[]),(0,m.useEffect)(()=>{F()},[k,d,p]);let N=async()=>{try{M((await l.get(`/company/config`)).data.company)}catch{console.error(`Failed to load company config`)}},P=async()=>{try{w(!0);let e=localStorage.getItem(`companyId`),[t,n]=await Promise.all([l.get(`/invoices`,{params:{companyId:e}}),l.get(`/expenses`,{params:{companyId:e}})]);_(t.data),f(n.data)}catch(e){console.error(`Failed to load finance data`,e)}finally{w(!1)}},F=()=>{let e=new Date,{dateRange:t,category:n}=k,r=n=>{let r=new Date(n);if(t===`this_month`)return r.getMonth()===e.getMonth()&&r.getFullYear()===e.getFullYear();if(t===`last_month`){let t=new Date;return t.setMonth(e.getMonth()-1),r.getMonth()===t.getMonth()&&r.getFullYear()===t.getFullYear()}return t===`this_quarter`?Math.floor((e.getMonth()+3)/3)===Math.floor((r.getMonth()+3)/3)&&r.getFullYear()===e.getFullYear():t===`this_year`?r.getFullYear()===e.getFullYear():!0},i=p.filter(e=>r(e.date||e.createdAt)),a=d.filter(e=>r(e.date));n!==`all`&&(a=a.filter(e=>e.category?.toLowerCase()===n.toLowerCase())),b(a);let o=i.filter(e=>e.status===`PAID`).reduce((e,t)=>e+(t.grandTotal||0),0),s=i.filter(e=>e.status===`SENT`||e.status===`OVERDUE`).reduce((e,t)=>e+(t.grandTotal||0),0),c=a.reduce((e,t)=>e+(t.amount||0),0);S({revenue:o,outstanding:s,expenses:c,profit:o-c})},I=async e=>{e.preventDefault();try{let e=localStorage.getItem(`companyId`),t=await l.post(`/expenses`,{...D,companyId:e});f(e=>[t.data,...e]),E(!1),O({category:``,amount:``,description:``,paymentMethod:`Card`})}catch{alert(`Failed to create expense`)}},L=()=>{let e=document.createElement(`div`);e.style.width=`210mm`,e.style.padding=`15mm`,e.style.background=`white`,e.style.color=`#1e293b`,e.style.fontFamily=`'Helvetica Neue', Helvetica, Arial, sans-serif`;let t=new Date().toLocaleDateString(),n=y.map(e=>`
            <tr style="border-bottom: 1px solid #f1f5f9;">
                <td style="padding: 10px;">${e.category}</td>
                <td style="padding: 10px;">${new Date(e.date).toLocaleDateString()}</td>
                <td style="padding: 10px;">${e.description||`-`}</td>
                <td style="padding: 10px; text-align: right; color: #ef4444;">-₹${e.amount}</td>
            </tr>
        `).join(``);e.innerHTML=`
            <div>
                <!-- Header -->
                <div style="text-align: center; margin-bottom: 40px;">
                    ${j?.logo?`<img src="${j.logo}" style="height: 60px; margin-bottom: 10px;" />`:``}
                    <h1 style="margin: 0; font-size: 24px; color: #0f172a;">${j?.name||`Company Name`}</h1>
                    <p style="margin: 5px 0; color: #64748b;">Financial Report</p>
                    <p style="margin: 0; font-size: 14px; color: #94a3b8;">${k.dateRange.replace(`_`,` `).toUpperCase()} • Generated on ${t}</p>
                </div>

                <!-- Summary Cards -->
                <div style="display: flex; gap: 20px; margin-bottom: 40px;">
                    <div style="flex: 1; padding: 15px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                        <div style="font-size: 12px; color: #64748b; text-transform: uppercase; font-weight: bold;">Revenue</div>
                        <div style="font-size: 20px; font-weight: bold; color: #16a34a;">+${z(x.revenue)}</div>
                    </div>
                    <div style="flex: 1; padding: 15px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                        <div style="font-size: 12px; color: #64748b; text-transform: uppercase; font-weight: bold;">Expenses</div>
                        <div style="font-size: 20px; font-weight: bold; color: #ef4444;">-${z(x.expenses)}</div>
                    </div>
                    <div style="flex: 1; padding: 15px; background: #f8fafc; border-radius: 8px; border: 1px solid #e2e8f0;">
                        <div style="font-size: 12px; color: #64748b; text-transform: uppercase; font-weight: bold;">Net Profit</div>
                        <div style="font-size: 20px; font-weight: bold; color: #2563eb;">${z(x.profit)}</div>
                    </div>
                </div>

                <!-- Expenses Table -->
                <h3 style="border-bottom: 2px solid #e2e8f0; padding-bottom: 10px; margin-bottom: 20px;">Expense Breakdown</h3>
                <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                    <thead>
                        <tr style="background: #f1f5f9; text-align: left;">
                            <th style="padding: 10px;">Category</th>
                            <th style="padding: 10px;">Date</th>
                            <th style="padding: 10px;">Description</th>
                            <th style="padding: 10px; text-align: right;">Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${n||`<tr><td colspan="4" style="padding: 20px; text-align: center; color: #94a3b8;">No expenses found for this period.</td></tr>`}
                    </tbody>
                </table>
                
                <div style="margin-top: 40px; text-align: center; font-size: 12px; color: #94a3b8;">
                    This is a system generated report.
                </div>
            </div>
        `,(0,h.default)().from(e).save(`Finance_Report_${k.dateRange}.pdf`)},R=e=>e?new Date(e).toLocaleDateString():`-`,z=e=>new Intl.NumberFormat(`en-IN`,{style:`currency`,currency:`INR`}).format(e);return C?(0,g.jsx)(`div`,{className:`p-10 text-center`,children:`Loading finance data...`}):(0,g.jsxs)(`div`,{className:`space-y-8`,children:[(0,g.jsxs)(`div`,{className:`flex flex-col md:flex-row justify-between items-start md:items-center gap-4`,children:[(0,g.jsxs)(`div`,{children:[(0,g.jsx)(`h1`,{className:`text-2xl font-bold text-slate-800`,children:`Financial Overview`}),(0,g.jsx)(`p`,{className:`text-sm text-slate-500 mt-1`,children:`Track revenue, expenses, and profitability.`})]}),(0,g.jsxs)(`div`,{className:`flex gap-3`,children:[(0,g.jsxs)(`button`,{onClick:L,className:`flex items-center gap-2 px-4 py-2 bg-white text-slate-700 border border-slate-200 rounded-lg text-sm font-medium hover:bg-slate-50`,children:[(0,g.jsx)(n,{size:18}),` Generate Report`]}),(0,g.jsxs)(`button`,{onClick:()=>u(`/dashboard/backup-reports`),className:`flex items-center gap-2 px-4 py-2 bg-white text-slate-700 border border-slate-200 rounded-lg text-sm font-medium hover:bg-slate-50`,children:[(0,g.jsx)(r,{size:18}),` Backup & Reports`]}),(0,g.jsxs)(`button`,{onClick:()=>E(!0),className:`flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700 shadow-sm`,children:[(0,g.jsx)(a,{size:18}),` Record Expense`]})]})]}),(0,g.jsxs)(`div`,{className:`bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex flex-wrap gap-4 items-center`,children:[(0,g.jsxs)(`div`,{className:`flex items-center gap-2 text-slate-500 text-sm font-medium`,children:[(0,g.jsx)(i,{size:16}),` Filters:`]}),(0,g.jsxs)(`select`,{className:`bg-slate-50 border border-slate-200 text-slate-700 text-sm rounded-lg p-2.5 outline-none focus:ring-1 focus:ring-blue-500`,value:k.dateRange,onChange:e=>A({...k,dateRange:e.target.value}),children:[(0,g.jsx)(`option`,{value:`this_month`,children:`This Month`}),(0,g.jsx)(`option`,{value:`last_month`,children:`Last Month`}),(0,g.jsx)(`option`,{value:`this_quarter`,children:`This Quarter`}),(0,g.jsx)(`option`,{value:`this_year`,children:`This Year`}),(0,g.jsx)(`option`,{value:`all`,children:`All Time`})]}),(0,g.jsxs)(`select`,{className:`bg-slate-50 border border-slate-200 text-slate-700 text-sm rounded-lg p-2.5 outline-none focus:ring-1 focus:ring-blue-500`,value:k.category,onChange:e=>A({...k,category:e.target.value}),children:[(0,g.jsx)(`option`,{value:`all`,children:`All Categories`}),(0,g.jsx)(`option`,{value:`operations`,children:`Operations`}),(0,g.jsx)(`option`,{value:`marketing`,children:`Marketing`}),(0,g.jsx)(`option`,{value:`payroll`,children:`Payroll`}),(0,g.jsx)(`option`,{value:`software`,children:`Software`}),(0,g.jsx)(`option`,{value:`office`,children:`Office`})]})]}),(0,g.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-4 gap-6`,children:[(0,g.jsx)(v,{title:`Total Revenue`,value:z(x.revenue),icon:(0,g.jsx)(s,{size:24,className:`text-green-600`}),trend:`Based on paid invoices`}),(0,g.jsx)(v,{title:`Total Expenses`,value:z(x.expenses),icon:(0,g.jsx)(o,{size:24,className:`text-red-600`}),trend:`Based on recorded expenses`}),(0,g.jsx)(v,{title:`Net Profit`,value:z(x.profit),icon:(0,g.jsx)(t,{size:24,className:`text-blue-600`}),trend:`Revenue - Expenses`}),(0,g.jsx)(v,{title:`Outstanding`,value:z(x.outstanding),icon:(0,g.jsx)(e,{size:24,className:`text-amber-600`}),trend:`Pending invoices`})]}),(0,g.jsxs)(`div`,{className:`grid grid-cols-1 lg:grid-cols-2 gap-6`,children:[(0,g.jsxs)(`div`,{className:`bg-white p-6 rounded-xl border border-slate-200 shadow-sm min-h-[300px] flex flex-col justify-center items-center text-center`,children:[(0,g.jsx)(`div`,{className:`bg-blue-50 p-4 rounded-full mb-4`,children:(0,g.jsx)(s,{size:32,className:`text-blue-500`})}),(0,g.jsx)(`h3`,{className:`text-lg font-semibold text-slate-800`,children:`Cash Flow Analytics`}),(0,g.jsx)(`p`,{className:`text-slate-500 text-sm mt-2 max-w-xs`,children:`Detailed revenue vs expense charts will appear here based on your data.`})]}),(0,g.jsxs)(`div`,{className:`bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden flex flex-col`,children:[(0,g.jsxs)(`div`,{className:`px-6 py-4 border-b border-slate-200 flex justify-between items-center`,children:[(0,g.jsx)(`h3`,{className:`text-lg font-semibold text-slate-800`,children:`Recent Expenses`}),(0,g.jsxs)(`span`,{className:`text-xs text-slate-500`,children:[y.length,` records`]})]}),(0,g.jsx)(`div`,{className:`flex-grow overflow-y-auto max-h-[400px]`,children:y.length>0?(0,g.jsxs)(`table`,{className:`w-full text-left text-sm`,children:[(0,g.jsx)(`thead`,{className:`bg-slate-50 text-slate-500 font-medium`,children:(0,g.jsxs)(`tr`,{children:[(0,g.jsx)(`th`,{className:`px-6 py-3`,children:`Category`}),(0,g.jsx)(`th`,{className:`px-6 py-3`,children:`Date`}),(0,g.jsx)(`th`,{className:`px-6 py-3 text-right`,children:`Amount`})]})}),(0,g.jsx)(`tbody`,{className:`divide-y divide-slate-100`,children:y.map(e=>(0,g.jsxs)(`tr`,{className:`hover:bg-slate-50`,children:[(0,g.jsx)(`td`,{className:`px-6 py-3 font-medium text-slate-900`,children:e.category}),(0,g.jsx)(`td`,{className:`px-6 py-3 text-slate-500`,children:R(e.date)}),(0,g.jsxs)(`td`,{className:`px-6 py-3 text-right font-bold text-red-600`,children:[`-`,z(e.amount)]})]},e._id))})]}):(0,g.jsx)(`div`,{className:`p-10 text-center text-slate-500`,children:`No expenses found for this selection.`})})]})]}),T&&(0,g.jsx)(`div`,{className:`fixed inset-0 bg-black/50 flex items-center justify-center z-50`,children:(0,g.jsxs)(`div`,{className:`bg-white rounded-xl p-6 w-full max-w-sm`,children:[(0,g.jsx)(`h2`,{className:`text-xl font-bold mb-4`,children:`Add Expense`}),(0,g.jsxs)(`form`,{onSubmit:I,className:`space-y-4`,children:[(0,g.jsx)(`input`,{required:!0,placeholder:`Category (e.g. Rent, Server)`,className:`w-full border p-2 rounded`,value:D.category,onChange:e=>O({...D,category:e.target.value})}),(0,g.jsx)(`input`,{required:!0,type:`number`,placeholder:`Amount`,className:`w-full border p-2 rounded`,value:D.amount,onChange:e=>O({...D,amount:e.target.value})}),(0,g.jsx)(`input`,{placeholder:`Description`,className:`w-full border p-2 rounded`,value:D.description,onChange:e=>O({...D,description:e.target.value})}),(0,g.jsxs)(`select`,{className:`w-full border p-2 rounded`,value:D.paymentMethod,onChange:e=>O({...D,paymentMethod:e.target.value}),children:[(0,g.jsx)(`option`,{value:`Card`,children:`Card`}),(0,g.jsx)(`option`,{value:`Bank Transfer`,children:`Bank Transfer`}),(0,g.jsx)(`option`,{value:`Cash`,children:`Cash`})]}),(0,g.jsxs)(`div`,{className:`flex justify-end gap-2 mt-6`,children:[(0,g.jsx)(`button`,{type:`button`,onClick:()=>E(!1),className:`px-4 py-2 text-slate-600 hover:bg-slate-100 rounded`,children:`Cancel`}),(0,g.jsx)(`button`,{type:`submit`,className:`px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700`,children:`Add Expense`})]})]})]})})]})}var v=({title:e,value:t,icon:n,trend:r})=>(0,g.jsxs)(`div`,{className:`bg-white p-6 rounded-xl border border-slate-200 shadow-sm flex flex-col justify-between h-32`,children:[(0,g.jsxs)(`div`,{className:`flex justify-between items-start`,children:[(0,g.jsx)(`span`,{className:`text-sm font-medium text-slate-500`,children:e}),(0,g.jsx)(`div`,{className:`bg-slate-50 p-2 rounded-lg`,children:n})]}),(0,g.jsxs)(`div`,{children:[(0,g.jsx)(`div`,{className:`text-2xl font-bold text-slate-900`,children:t}),(0,g.jsx)(`div`,{className:`text-xs text-slate-500 mt-1`,children:r})]})]});export{_ as default};